#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
增强版命令行工具示例
====================

这个脚本演示了带有基本功能和默认功能(如帮助和版本)的命令行工具。
"""

import os
import sys
import shutil
import time
import argparse

# 版本信息
VERSION = "1.0.0"

def list_files(directory='.'):
    """列出指定目录下的所有文件"""
    print(f"目录 {directory} 中的文件:")
    for item in os.listdir(directory):
        item_path = os.path.join(directory, item)
        last_modified = time.ctime(os.path.getmtime(item_path))
        size = os.path.getsize(item_path)
        
        if os.path.isdir(item_path):
            print(f"[DIR]  {item:30} {last_modified:30} {size:10} bytes")
        else:
            print(f"[FILE] {item:30} {last_modified:30} {size:10} bytes")

def search_files(keyword, directory='.'):
    """搜索包含关键词的文件"""
    print(f"搜索包含 '{keyword}' 的文件:")
    found = False
    
    for root, _, files in os.walk(directory):
        for file in files:
            if keyword.lower() in file.lower():
                file_path = os.path.join(root, file)
                print(f"找到: {file_path}")
                found = True
    
    if not found:
        print(f"没有找到包含 '{keyword}' 的文件")

def copy_file(source, destination):
    """复制文件"""
    try:
        shutil.copy2(source, destination)
        print(f"已复制: {source} -> {destination}")
    except Exception as e:
        print(f"复制失败: {e}")

def show_version():
    """显示版本信息"""
    print(f"文件工具 v{VERSION}")
    print("Copyright (c) 2025")

def main():
    """主函数"""
    # 使用argparse进行命令行解析
    parser = argparse.ArgumentParser(description="文件管理工具")
    subparsers = parser.add_subparsers(dest="command", help="可用命令")
    
    # 定义list命令
    list_parser = subparsers.add_parser("list", help="列出文件")
    list_parser.add_argument("directory", nargs="?", default=".", help="要列出的目录")
    
    # 定义search命令
    search_parser = subparsers.add_parser("search", help="搜索文件")
    search_parser.add_argument("keyword", help="搜索关键词")
    search_parser.add_argument("directory", nargs="?", default=".", help="搜索目录")
    
    # 定义copy命令
    copy_parser = subparsers.add_parser("copy", help="复制文件")
    copy_parser.add_argument("source", help="源文件")
    copy_parser.add_argument("destination", help="目标路径")
    
    # 定义version命令
    version_parser = subparsers.add_parser("version", help="显示版本信息")
    
    # 也可以使用-v或--version选项
    parser.add_argument("-v", "--version", action="store_true", help="显示版本信息")
    
    # 解析参数
    args = parser.parse_args()
    
    # 处理命令
    if args.version:
        show_version()
        return
        
    if args.command == "list":
        list_files(args.directory)
    elif args.command == "search":
        search_files(args.keyword, args.directory)
    elif args.command == "copy":
        copy_file(args.source, args.destination)
    elif args.command == "version":
        show_version()
    elif args.command is None:
        parser.print_help()

if __name__ == "__main__":
    main()
